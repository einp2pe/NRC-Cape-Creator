<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cape Creator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="muhehehe.png">
</head>
<body>

<div class="wrapper">

<h1>NRC Cape Creator</h1>

<div class="controls">

    <label>Select image for the "Front":</label><br>
    <input type="file" id="frontImageInput" accept="image/*"><br>

    <label>Select image for the "Back":</label><br>
    <input type="file" id="backImageInput" accept="image/*"><br>

    <label>Select image for the "Elytra":</label><br>
    <input type="file" id="elytraImageInput" accept="image/*"><br>

    <label>Cape color:</label><br>
    <input type="color" id="colorPicker" value="#002aff"><br>

    <label><input type="checkbox" id="enableGradient"> Enable gradient</label><br>

    <div id="gradientControls" style="display:none; margin-left:20px;">
        <label>1. Gradient color:</label><br>
        <input type="color" id="gradColor1" value="#002aff"><br>

        <label>2. Gradient color:</label><br>
        <input type="color" id="gradColor2" value="#ff0000"><br>

        <label>Direction:</label><br>
        <select id="gradDirection">
            <option value="vertical">Vertical</option>
            <option value="horizontal">Horizontal</option>
            <option value="diag1">Diagonal ↘</option>
            <option value="diag2">Diagonal ↙</option>
        </select>
    </div>

    <button id="downloadBtn">Download Cape</button>
    <button id="resetBtn">Reset</button>
</div>

<canvas id="capeCanvas" width="512" height="256"></canvas>

</div>

<script>
const templateSrc = "nrc_cape_template.png";
const templateImg = new Image();
templateImg.src = templateSrc;

const canvas = document.getElementById("capeCanvas");
const ctx = canvas.getContext("2d");

let frontImage = null;
let backImage = null;
let elytraImage = null;

// Cape positions
const FRONT_X = 8;
const FRONT_Y = 8;
const FRONT_W = 80;
const FRONT_H = 128;

const BACK_X = 96;
const BACK_Y = 8;
const BACK_W = 80;
const BACK_H = 128;

// Elytra position (your exact spec)
const ELYTRA_X = 288;
const ELYTRA_Y = 16;
const ELYTRA_W = 80;
const ELYTRA_H = 160;

templateImg.onload = () => drawCape();

function createGradient() {
    const dir = document.getElementById("gradDirection").value;
    const c1 = document.getElementById("gradColor1").value;
    const c2 = document.getElementById("gradColor2").value;

    let grad;

    if (dir === "vertical") grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    else if (dir === "horizontal") grad = ctx.createLinearGradient(0, 0, canvas.width, 0);
    else if (dir === "diag1") grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    else grad = ctx.createLinearGradient(canvas.width, 0, 0, canvas.height);

    grad.addColorStop(0, c1);
    grad.addColorStop(1, c2);

    return grad;
}

function drawCape() {
    if (!templateImg.complete) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw template first
    ctx.drawImage(templateImg, 0, 0);

    // Cape coloring
    let fillStyle =
        document.getElementById("enableGradient").checked
            ? createGradient()
            : document.getElementById("colorPicker").value;

    ctx.globalCompositeOperation = "source-atop";
    ctx.fillStyle = fillStyle;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Put outline OVER the color
    ctx.globalCompositeOperation = "destination-over";
    ctx.drawImage(templateImg, 0, 0);

    ctx.globalCompositeOperation = "source-over";

    // Front / back cape images
    if (frontImage) ctx.drawImage(frontImage, FRONT_X, FRONT_Y, FRONT_W, FRONT_H);
    if (backImage) ctx.drawImage(backImage, BACK_X, BACK_Y, BACK_W, BACK_H);

    // --------------------------
    // ⭐ ELYTRA MASK / CROP ⭐
    // --------------------------
    if (elytraImage) {

        // Mask canvas (pinke Elytra-Form)
        const maskCanvas = document.createElement("canvas");
        maskCanvas.width = ELYTRA_W;
        maskCanvas.height = ELYTRA_H;
        const maskCtx = maskCanvas.getContext("2d");

        // Extract pink Elytra mask from template
        maskCtx.drawImage(
            templateImg,
            ELYTRA_X, ELYTRA_Y, ELYTRA_W, ELYTRA_H,
            0, 0, ELYTRA_W, ELYTRA_H
        );

        // Elytra drawing canvas
        const elyCanvas = document.createElement("canvas");
        elyCanvas.width = ELYTRA_W;
        elyCanvas.height = ELYTRA_H;
        const elyCtx = elyCanvas.getContext("2d");

        // Draw user Elytra
        elyCtx.drawImage(elytraImage, 0, 0, ELYTRA_W, ELYTRA_H);

        // ⭐ Apply mask — cut off everything outside pink
        elyCtx.globalCompositeOperation = "destination-in";
        elyCtx.drawImage(maskCanvas, 0, 0);

        // Draw masked Elytra onto final texture
        ctx.drawImage(elyCanvas, ELYTRA_X, ELYTRA_Y);
    }

    ctx.globalCompositeOperation = "source-over";
}

// Event listeners
document.getElementById("enableGradient").addEventListener("change", () => {
    document.getElementById("gradientControls").style.display =
        document.getElementById("enableGradient").checked ? "block" : "none";
    drawCape();
});

["gradColor1", "gradColor2", "gradDirection"].forEach(id => {
    document.getElementById(id).addEventListener("input", drawCape);
});

document.getElementById("colorPicker").addEventListener("input", drawCape);

document.getElementById("frontImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.src = URL.createObjectURL(file);

    img.onload = () => {
        frontImage = img;
        drawCape();
    };
});

document.getElementById("backImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.src = URL.createObjectURL(file);

    img.onload = () => {
        backImage = img;
        drawCape();
    };
});

document.getElementById("elytraImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.src = URL.createObjectURL(file);

    img.onload = () => {
        elytraImage = img;
        drawCape();
    };
});

document.getElementById("downloadBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "custom_cape.png";
    link.href = canvas.toDataURL();
    link.click();
});

document.getElementById("resetBtn").addEventListener("click", () => {
    frontImage = null;
    backImage = null;
    elytraImage = null;

    document.getElementById("frontImageInput").value = "";
    document.getElementById("backImageInput").value = "";
    document.getElementById("elytraImageInput").value = "";

    document.getElementById("colorPicker").value = "#002aff";
    document.getElementById("enableGradient").checked = false;
    document.getElementById("gradientControls").style.display = "none";
    document.getElementById("gradColor1").value = "#002aff";
    document.getElementById("gradColor2").value = "#ff0000";
    document.getElementById("gradDirection").value = "vertical";

    drawCape();
});
</script>

</body>
</html>





