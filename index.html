<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cape Creator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="muhehehe.png">
</head>
<body>

<h1>Cape Creation Tool</h1>

<div class="controls">

    <label>Select image for the "Front":</label><br>
    <input type="file" id="frontImageInput" accept="image/*"><br>

    <label>Select image for the "Back":</label><br>
    <input type="file" id="backImageInput" accept="image/*"><br>

    <label>Cape color:</label><br>
    <input type="color" id="colorPicker" value="#ff00ff"><br>

    <label><input type="checkbox" id="enableGradient">Enable gradient</label><br>

    <div id="gradientControls" style="display:none; margin-left:20px;">
        <label>1. Gradient color:</label><br>
        <input type="color" id="gradColor1" value="#ff00ff"><br>

        <label>2. Gradient color:</label><br>
        <input type="color" id="gradColor2" value="#0000ff"><br>

        <label>Direction:</label><br>
        <select id="gradDirection">
            <option value="vertical">Vertical</option>
            <option value="horizontal">Horizontal</option>
            <option value="diag1">Diagonal ↘</option>
            <option value="diag2">Diagonal ↙</option>
        </select>
    </div>

    <button id="downloadBtn">Download Cape</button>
    <button id="resetBtn">Reset</button>
</div>

<canvas id="capeCanvas" width="512" height="256"></canvas>

<script>
const templateSrc = "nrc_cape_template.png";
const templateImg = new Image();
templateImg.src = templateSrc;

const canvas = document.getElementById("capeCanvas");
const ctx = canvas.getContext("2d");

let frontImage = null;
let backImage = null;

const FRONT_X = 8;
const FRONT_Y = 8;
const FRONT_W = 80;
const FRONT_H = 128;

const BACK_X = 96;
const BACK_Y = 8;
const BACK_W = 80;
const BACK_H = 128;

templateImg.onload = () => drawCape();

function createGradient() {
    const dir = document.getElementById("gradDirection").value;
    const c1 = document.getElementById("gradColor1").value;
    const c2 = document.getElementById("gradColor2").value;

    let grad;

    if (dir === "vertical") {
        grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    } else if (dir === "horizontal") {
        grad = ctx.createLinearGradient(0, 0, canvas.width, 0);
    } else if (dir === "diag1") {
        grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    } else if (dir === "diag2") {
        grad = ctx.createLinearGradient(canvas.width, 0, 0, canvas.height);
    }

    grad.addColorStop(0, c1);
    grad.addColorStop(1, c2);

    return grad;
}

function drawCape() {
    if (!templateImg.complete) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.drawImage(templateImg, 0, 0);

    let fillStyle;

    if (document.getElementById("enableGradient").checked) {
        fillStyle = createGradient();
    } else {
        fillStyle = document.getElementById("colorPicker").value;
    }

    ctx.globalCompositeOperation = "source-atop";
    ctx.fillStyle = fillStyle;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.globalCompositeOperation = "destination-over";
    ctx.drawImage(templateImg, 0, 0);

    ctx.globalCompositeOperation = "source-over";

    if (frontImage) {
        ctx.drawImage(frontImage, FRONT_X, FRONT_Y, FRONT_W, FRONT_H);
    }

    if (backImage) {
        ctx.drawImage(backImage, BACK_X, BACK_Y, BACK_W, BACK_H);
    }

    ctx.globalCompositeOperation = "source-over";
}

document.getElementById("enableGradient").addEventListener("change", () => {
    document.getElementById("gradientControls").style.display =
        document.getElementById("enableGradient").checked ? "block" : "none";
    drawCape();
});

["gradColor1", "gradColor2", "gradDirection"].forEach(id => {
    document.getElementById(id).addEventListener("input", drawCape);
});

document.getElementById("colorPicker").addEventListener("input", drawCape);

document.getElementById("frontImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.src = URL.createObjectURL(file);
    img.onload = () => {
        frontImage = img;
        drawCape();
    };
});

document.getElementById("backImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.src = URL.createObjectURL(file);
    img.onload = () => {
        backImage = img;
        drawCape();
    };
});

document.getElementById("downloadBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "custom_cape.png";
    link.href = canvas.toDataURL();
    link.click();
});

document.getElementById("resetBtn").addEventListener("click", () => {

    // Reset internal images
    frontImage = null;
    backImage = null;

    // Reset input fields
    document.getElementById("frontImageInput").value = "";
    document.getElementById("backImageInput").value = "";

    // Reset primary color
    document.getElementById("colorPicker").value = "#ff00ff";

    // Reset gradient toggle
    document.getElementById("enableGradient").checked = false;
    document.getElementById("gradientControls").style.display = "none";

    // Reset gradient colors and direction
    document.getElementById("gradColor1").value = "#ff00ff";
    document.getElementById("gradColor2").value = "#0000ff";
    document.getElementById("gradDirection").value = "vertical";

    // Redraw cape with defaults
    drawCape();
});
</script>

</body>
</html>
